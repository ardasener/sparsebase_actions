<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Representing operations using SparsePreprocess &mdash; SparseBase v0.1.5 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sparse Format Guide" href="sparse_format.html" />
    <link rel="prev" title="Explanations" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> SparseBase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Explanations</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Representing operations using SparsePreprocess</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hierarchy">Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why-use-the-instance-class">Why use the instance class?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sparse_format.html">Sparse Format Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_guides/index.html">How To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/library_root.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SparseBase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Explanations</a> &raquo;</li>
      <li>Representing operations using SparsePreprocess</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/explanations/explanation_sparsepreprocess.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="representing-operations-using-sparsepreprocess">
<h1>Representing operations using SparsePreprocess<a class="headerlink" href="#representing-operations-using-sparsepreprocess" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Preprocessing, as in the name, represents preprocessing operations that involve <code class="docutils literal notranslate"><span class="pre">SparseFormat</span></code> objects. Reordering, partitioning, graph coarsening, matrix factorization, and tensor decomposition are a few examples of such operations. Preprocessing in SparseBase is done using objects. Each object carries out a certain operation and can contain multiple functions that handle different <code class="docutils literal notranslate"><span class="pre">SparseFormat</span></code> formats. Every object also comes with a matching and conversion mechanism for these functions. This mechanism allows the object to take the user input, find a function that matches the input format, and if none are found, convert the input into a different format for which it has a function. This mechanism has two main benefits:</p>
<ol class="arabic simple">
<li><p><strong>Users need a single representation only.</strong> Users do not need to worry about the format of their data. The library will take care of doing the necessary conversions to carry out their work. Simply load your data and pass it to a <code class="docutils literal notranslate"><span class="pre">SparsePreprocess</span></code> object and it will do the work for you.</p></li>
<li><p><strong>Developers don’t need to cover the entire format space.</strong> When a developer wishes to add a <code class="docutils literal notranslate"><span class="pre">SparsePreprocess</span></code> implementation, e.g. a new reordering implementation, they do not need to account for every input format. A single implementation on a common format will be sufficient; any object that is convertible to that format will be able to use the reordering. Of course, if they wish, they could provide additional implementations for different sparse formats.</p></li>
</ol>
<p>The rest of this document will describe the hierarchy of <code class="docutils literal notranslate"><span class="pre">SparsePreprocess</span></code>.</p>
</section>
<section id="hierarchy">
<h2>Hierarchy<a class="headerlink" href="#hierarchy" title="Permalink to this headline"></a></h2>
<p>Since <code class="docutils literal notranslate"><span class="pre">SparsePreprocess</span></code> can be used as an abstraction for many different perprocessing operations. It is important to keep it as generic as possible. We achieve this generality by making <code class="docutils literal notranslate"><span class="pre">SparsePreprocess</span></code> abstract in terms of the <em>preprocess operation’s function signature</em>, or what we will refer to moving forward as <code class="docutils literal notranslate"><span class="pre">PreprocessFunction</span></code>. In other words, a preprocess type can be created for any combination of inputs and outputs — the data types of inputs and outputs have no restrictions, and there can be as many inputs as the developer needs. Obviously, inputs should have at least one <code class="docutils literal notranslate"><span class="pre">SparseFormat</span></code> object to justify using the <code class="docutils literal notranslate"><span class="pre">SparsePreprocess</span></code> matching mechanism.</p>
<p>Using this generalization, we classify <code class="docutils literal notranslate"><span class="pre">SparsePreprocess</span></code> into different <em>types;</em> a <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code> is identified by the signature of its function, i.e., its <code class="docutils literal notranslate"><span class="pre">PreprocessFunction</span></code>. For example, reordering, partitioning, coarsening, and factorization are all different types, and this is the <code class="docutils literal notranslate"><span class="pre">PreprocessFunction</span></code> defining the reorder type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">IDType</span><span class="o">*</span> <span class="n">ReorderFunction</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SparseFormat</span><span class="o">&lt;</span><span class="n">IDType</span><span class="p">,</span> <span class="n">NumNonZerosType</span><span class="o">&gt;*&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Concretely, each <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code> is defined by a class that is templated using the type’s <code class="docutils literal notranslate"><span class="pre">PreprocessFunction</span></code>.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code> can have multiple <em>implementations.</em> These are different algorithms or approaches used to carry out this preprocessing, with each being represented by a class. For example, METIS, Kernighan-Lin, and Fiduccia-Mattheyses are all different implementations of the partitioning <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code>. Every implementation can have multiple functions, each accommodating different <code class="docutils literal notranslate"><span class="pre">SparseFormat</span></code> formats. This is where the function matching and format conversion takes place. For example, the METIS partitioning implementation can have a single function only that takes a <code class="docutils literal notranslate"><span class="pre">SparseFormat</span></code> object with the CSR format as input. However, users will be able to use METIS partitioning even if their data was in a different format — as long as that format is convertible to CSR.</p>
<p>Finally, each <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code> can have one or more <code class="docutils literal notranslate"><span class="pre">PreprocessInstance</span></code> classes. These are adapters that take an implementation class and expose an API to the user. Every <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code> has a <code class="docutils literal notranslate"><span class="pre">PreprocessInstance</span></code> that can be used with all of its implementations. However, one can also build instances for specific implementations as well. For example, the <code class="docutils literal notranslate"><span class="pre">ReorderInstance</span></code> is an instance that can be used with any reordering implementation (RCM, degree, etc.) and it will expose the same API to the user regardless of the implementation its given. On the other hand, the <code class="docutils literal notranslate"><span class="pre">RCMReorderInstance</span></code> is an instance that is specifically made for RCM reordering, and its API can be specialized for it. The following example demonstrates the usage of preprocessing instances:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;sparsebase/sparse_format.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;sparsebase/sparse_preprocess.h&quot;</span><span class="cp"></span>

<span class="n">sparsebase</span><span class="o">::</span><span class="n">COO</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="n">coo</span><span class="p">;</span>
<span class="n">sparsebase</span><span class="o">::</span><span class="n">ReorderInstance</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span><span class="p">,</span> <span class="n">sparsebase</span><span class="o">::</span><span class="n">RCMReorder</span><span class="o">&gt;</span> <span class="n">rcm_orderer</span><span class="p">;</span>
<span class="c1">// Even though there is no function to carry out RCM Reordering </span>
<span class="c1">// on a COO, the data will be converted to CSR behind the scenes</span>
<span class="c1">// and reordered.</span>
<span class="k">auto</span> <span class="n">order</span> <span class="o">=</span> <span class="n">rcm_reorderer</span><span class="p">.</span><span class="n">GetOrder</span><span class="p">(</span><span class="n">csr</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="why-use-the-instance-class">
<h2>Why use the instance class?<a class="headerlink" href="#why-use-the-instance-class" title="Permalink to this headline"></a></h2>
<p>An important design decision was whether or not to merge the <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code> and <code class="docutils literal notranslate"><span class="pre">PreprocessInstance</span></code> classes into a single class. This would mean that a <code class="docutils literal notranslate"><span class="pre">PreprocessType</span></code> would be defined by its operation’s function signature, as well as its public API. Even though this approach might have resulted in cleaner code, we found it might not be as scalable as the current approach. The current approach allows for multiple APIs for a single preprocess type, which we believe might become necessary for more complex preprocessing types.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Explanations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sparse_format.html" class="btn btn-neutral float-right" title="Sparse Format Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SparCity Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>