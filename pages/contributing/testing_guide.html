<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testing &mdash; SparseBase v0.2.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Making Contributions to the Repo" href="github_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> SparseBase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/index.html">Explanations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_guides/index.html">How To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/library_root.html">Library API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="documentation_guide.html">Documentation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="github_guide.html">Making Contributions to the Repo</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assertions">Assertions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-message">Custom message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assertion-semantics">Assertion semantics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#test-cases">Test cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-fixtures">Test Fixtures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-up-and-tear-down">Set up and tear down</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-a-fixture">Defining a fixture</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-tests">Adding tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-new-test-file">Adding a new test file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-about-cmake-options-and-flags">What about CMake options and flags?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running tests</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SparseBase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Contributing</a> &raquo;</li>
      <li>Testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/contributing/testing_guide.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline"></a></h1>
<p>We use Google Test for carrying out tests. It is a compiled testing library with minimal dependencies. It’s integrated into the project using git submodules. We start by going through some Google Test basics. If you’re familiar with Google Tests and wish to see how to add tests to our project, skip to the <a class="reference external" href="#adding-tests">Adding Tests</a> section.</p>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline"></a></h2>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Term</p></th>
<th class="head"><p>GTest API</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Assertion</p></td>
<td><p>ASSERT_<em>/EXEPECT_</em></p></td>
<td><p>A single check of the behavior of the program.</p></td>
</tr>
<tr class="row-odd"><td><p>Test (case)</p></td>
<td><p>TEST</p></td>
<td><p>Exercise a particular program using a set of inputs and verify the results. It is made up of one or more assertions.</p></td>
</tr>
<tr class="row-even"><td><p>Test suite</p></td>
<td><p>TestSuite</p></td>
<td><p>A group of related test (cases).</p></td>
</tr>
<tr class="row-odd"><td><p>Test fixture class</p></td>
<td><p>class _ : public ::testing::Test {};</p></td>
<td><p>A class containing objects and routines that can be reused by multiple test cases.</p></td>
</tr>
<tr class="row-even"><td><p>Test program</p></td>
<td><p></p></td>
<td><p>A piece of code containing one or more test suites.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="assertions">
<h2>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline"></a></h2>
<p>A test is done through one or more <em>assertions.</em> An assertion can succeed or fail, and failures are two types depending on the name of the assertion:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">EXPECT_*</span></code> - nonfatal failure:  a failure that does not terminate the current function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ASSERT_*</span></code> - fatal failure: a failure that aborts the current function</p>
<p>Important: this can cause memory leaks since clean-up code doesn’t run. Be careful.</p>
</li>
</ol>
<section id="custom-message">
<h3>Custom message<a class="headerlink" href="#custom-message" title="Permalink to this headline"></a></h3>
<p>When an assertion fails, Google Test prints an automated message. Users can add their own message to an assertion using the <code class="docutils literal notranslate"><span class="pre">operator&lt;&lt;</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">y</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Vectors x and y are of unequal length&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="assertion-semantics">
<h3>Assertion semantics<a class="headerlink" href="#assertion-semantics" title="Permalink to this headline"></a></h3>
<p>Find the full list of assertions <a class="reference external" href="https://google.github.io/googletest/reference/assertions.html">here</a>.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Assertion</p></th>
<th class="head"><p>Functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>*_EQ(a, b)</p></td>
<td><p>Check a and b are equal</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="test-cases">
<h2>Test cases<a class="headerlink" href="#test-cases" title="Permalink to this headline"></a></h2>
<p>A test case is a C++ function containing a group of assertions. Since it’s a function, code within a test case has a state (variables) that can be changed within the test case, but different test cases cannot share states (variables). If all assertions in a test case pass then so does the test case, and if any of them fails then so does the test case.</p>
<p>A test case has a name and belongs to a test suite. We define a test case using the macro <code class="docutils literal notranslate"><span class="pre">TEST(TestSuiteName,</span> <span class="pre">TestName)</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">SparseFormatSuite</span><span class="p">,</span> <span class="n">CSR</span><span class="p">){</span>
   <span class="c1">// create variables</span>
   <span class="c1">// add assertions</span>
   <span class="c1">// clean up</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Test cases are grouped by test suite when executing.</p>
</section>
<section id="test-fixtures">
<h2>Test Fixtures<a class="headerlink" href="#test-fixtures" title="Permalink to this headline"></a></h2>
<p>When multiple tests might use the same initial state (same starting variables), we can place these variables inside a “Fixture” class that defines how they are constructed and deleted. Then, every test case that needs these variables in this initial state will get a fresh copy of the fixture without any code repetition. Methods can also be added to fixtures for added utility.</p>
<p>Here is an example of a fixture:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">QueueTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
     <span class="n">q1_</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
     <span class="n">q2_</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
     <span class="n">q2_</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// void TearDown() override {}</span>

  <span class="n">Queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q0_</span><span class="p">;</span>
  <span class="n">Queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q1_</span><span class="p">;</span>
  <span class="n">Queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q2_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>A test case can use a single fixture only. When a test case function is going to use a fixture <code class="docutils literal notranslate"><span class="pre">FixtureTest</span></code>, you define it using the macro <code class="docutils literal notranslate"><span class="pre">TEST_F(FixtureTest,</span> <span class="pre">TestCaseName)</span></code> macro. The test suite name of the test case will be the fixture name.</p>
<p>When you define a test case using a fixture, you can think of it as creating a sub-class of the fixture, and adding the test case function as a member of the child. Therefore, you have access to all the protected data members of the fixture directly. Here are two test cases using the fixture above.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">QueueTest</span><span class="p">,</span> <span class="n">IsEmptyInitially</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">q0_</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">QueueTest</span><span class="p">,</span> <span class="n">DequeueWorks</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">n</span> <span class="o">=</span> <span class="n">q0_</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">();</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>

  <span class="n">n</span> <span class="o">=</span> <span class="n">q1_</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">();</span>
  <span class="n">ASSERT_NE</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">q1_</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">n</span><span class="p">;</span>

  <span class="n">n</span> <span class="o">=</span> <span class="n">q2_</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">();</span>
  <span class="n">ASSERT_NE</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">q2_</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see, we use the data members <code class="docutils literal notranslate"><span class="pre">q0_</span></code>, <code class="docutils literal notranslate"><span class="pre">q1_</span></code>, and <code class="docutils literal notranslate"><span class="pre">q2_</span></code> directly.</p>
<p><strong>Important:</strong> each one of these test cases will use <em>a fresh copy</em> of the <code class="docutils literal notranslate"><span class="pre">QueueTest</span></code> fixture. They don’t affect each other.</p>
<section id="set-up-and-tear-down">
<h3>Set up and tear down<a class="headerlink" href="#set-up-and-tear-down" title="Permalink to this headline"></a></h3>
<p>Since the fixture is a class, you can define the steps for setting it up inside the constructor, or inside the <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> function. Similarly, you can define the clean-up code in the destructor or in the <code class="docutils literal notranslate"><span class="pre">TearDown()</span></code> function. For differences between the two, check <a class="reference external" href="https://google.github.io/googletest/faq.html#CtorVsSetUp">here.</a></p>
</section>
<section id="defining-a-fixture">
<h3>Defining a fixture<a class="headerlink" href="#defining-a-fixture" title="Permalink to this headline"></a></h3>
<p>To create a fixture:</p>
<ol class="arabic simple">
<li><p>Derive a class from <code class="docutils literal notranslate"><span class="pre">::testing::Test</span></code> . Start its body with <code class="docutils literal notranslate"><span class="pre">protected:</span></code>, as
we’ll want to access fixture members from sub-classes.</p></li>
<li><p>Inside the class, declare any objects you plan to use.</p></li>
<li><p>If necessary, write a default constructor or <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> function to prepare
the objects for each test. A common mistake is to spell <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> as
<strong><code class="docutils literal notranslate"><span class="pre">Setup()</span></code></strong> with a small <code class="docutils literal notranslate"><span class="pre">u</span></code> - Use <code class="docutils literal notranslate"><span class="pre">override</span></code> in C++11 to make sure you
spelled it correctly.</p></li>
<li><p>If necessary, write a destructor or <code class="docutils literal notranslate"><span class="pre">TearDown()</span></code> function to release any
resources you allocated in <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> . To learn when you should use the
constructor/destructor and when you should use <code class="docutils literal notranslate"><span class="pre">SetUp()/TearDown()</span></code>, read
the <a class="reference external" href="https://google.github.io/googletest/faq.html#CtorVsSetUp">FAQ</a>.</p></li>
<li><p>If needed, define subroutines for your tests to share.</p></li>
</ol>
</section>
</section>
<section id="adding-tests">
<h2>Adding tests<a class="headerlink" href="#adding-tests" title="Permalink to this headline"></a></h2>
<p>Test files follow the same structure as the source files of the library itself. Tests for code in the file <code class="docutils literal notranslate"><span class="pre">src/path/to/file/&lt;file_name&gt;.cc</span></code> are written in the file <code class="docutils literal notranslate"><span class="pre">tests/suites/path/to/file/&lt;file_name&gt;_tests.cpp</span></code>. Each test file will be a separate <code class="docutils literal notranslate"><span class="pre">CTest</span></code> test.</p>
<p>When adding a test for source code in some file, first check to see if that source code file has a matching test file. If it does, add your tests to that test file. Otherwise, create a new test file as shown in the next section and add your tests to that file.</p>
<section id="adding-a-new-test-file">
<h3>Adding a new test file<a class="headerlink" href="#adding-a-new-test-file" title="Permalink to this headline"></a></h3>
<p>The following are the steps needed to add a new test file.</p>
<section id="determine-the-directory-to-which-the-test-file-is-to-be-added-and-check-if-it-exists">
<h4>1. Determine the directory to which the test file is to be added and check if it exists.<a class="headerlink" href="#determine-the-directory-to-which-the-test-file-is-to-be-added-and-check-if-it-exists" title="Permalink to this headline"></a></h4>
<p>The directory of a test file must match the directory of the source file it is written for, with the <code class="docutils literal notranslate"><span class="pre">src/</span></code> root level directory being replaced by <code class="docutils literal notranslate"><span class="pre">tests/suites</span></code>.</p>
<p>For example, if the file you are writing tests for is <code class="docutils literal notranslate"><span class="pre">src/sparsebase/preprocess/preprocess.cc</span></code>, then the directory of the test file is <code class="docutils literal notranslate"><span class="pre">tests/suites/sparsebase/preprocess/</span></code>.</p>
<p>If that subdirectory already exists, you can skip steps 2 and 3.</p>
</section>
<section id="create-a-directory-for-your-test-file-if-one-doesn-t-already-exist">
<h4>2. Create a directory for your test file (if one doesn’t already exist).<a class="headerlink" href="#create-a-directory-for-your-test-file-if-one-doesn-t-already-exist" title="Permalink to this headline"></a></h4>
<p>Assuming that the source file you are writing the tests for is located in <code class="docutils literal notranslate"><span class="pre">src/path/to/file</span></code>, then you need to create a directory that matches that path in the <code class="docutils literal notranslate"><span class="pre">tests/suites/</span></code> folder.</p>
<p>For example, if the file you are writing tests for is <code class="docutils literal notranslate"><span class="pre">src/sparsebase/preprocess/preprocess.cc</span></code>, then you must create the directory <code class="docutils literal notranslate"><span class="pre">tests/suites/sparsebase/preprocess/</span></code>.</p>
</section>
<section id="create-a-cmakelists-txt-file-in-that-test-s-directory-if-one-doesn-t-already-exist">
<h4>3. Create a CMakeLists.txt file in that test’s directory (if one doesn’t already exist).<a class="headerlink" href="#create-a-cmakelists-txt-file-in-that-test-s-directory-if-one-doesn-t-already-exist" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file will be located in the same directory of the test file (the directory determined in step 1). It will contain the instructions for building the test executable as well as the test definition for CMake.</p>
<p>After creating the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file, you must add it to the root level tests <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file. At the end fo the <code class="docutils literal notranslate"><span class="pre">tests/CMakeLists.txt</span></code> file, add the directory you had just created as a subdirectory.</p>
<p>For example, if the directory created for the test file is <code class="docutils literal notranslate"><span class="pre">tests/suites/sparsebase/preprocess</span></code>, then you would create the empty file <code class="docutils literal notranslate"><span class="pre">tests/suites/sparsebase/preprocess/CMakeLists.txt</span></code> and add the following line to the end of the file <code class="docutils literal notranslate"><span class="pre">tests/CMakeLists.txt</span></code>:</p>
<div class="highlight-CMake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">sparsebase/preprocess</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-the-tests-source-file">
<h4>3. Create the tests source file.<a class="headerlink" href="#create-the-tests-source-file" title="Permalink to this headline"></a></h4>
<p>The file you create will be located in the test directory determined in step 1. It will have the same name as the source file that it is testing, with the addition of the suffix <code class="docutils literal notranslate"><span class="pre">_tests</span></code>.</p>
<p>For example, if the source file you are testing is <code class="docutils literal notranslate"><span class="pre">sparsebase/src/sparsebase/preprocess/preprocess.cc</span></code>, you will create the file <code class="docutils literal notranslate"><span class="pre">tests/suites/src/sparsebase/preprocess/preprocess_tests.cc</span></code>.</p>
<p>You must start this file by including the GTest header, the <code class="docutils literal notranslate"><span class="pre">sparsebase/config.h</span></code> header, and then whichever headers you need for the test. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;gtest/gtest.h&quot;</span><span class="cp"></span>

<span class="c1">// needed for CMake flags (e.g. CUDA, PIGO, etc.)</span>
<span class="cp">#include</span> <span class="cpf">&quot;sparsebase/config.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;sparsebase/format/format.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;sparsebase/object/object.h&quot;</span><span class="cp"></span>

<span class="c1">// test suites and test functions</span>
</pre></div>
</div>
<p>Your tests will follow these headers.</p>
</section>
<section id="add-an-executable-target-and-a-test-command-to-the-cmakelists-txt-file-in-the-test-file-directory">
<h4>4. Add an executable target and a test command to the ‘CMakeLists.txt’ file in the test file directory.<a class="headerlink" href="#add-an-executable-target-and-a-test-command-to-the-cmakelists-txt-file-in-the-test-file-directory" title="Permalink to this headline"></a></h4>
<p>Each test file will be compiled into an executable target, and each test executable will be added as a CTest test. The name of the CTest test of a test file is its path relative to the <code class="docutils literal notranslate"><span class="pre">tests/suites</span></code> directory, followed by its name, with the file delimiter being the underscore character. The name of the executable of a test file will be the name of its CTest test with the extension <code class="docutils literal notranslate"><span class="pre">.test</span></code>. For instance, the test file <code class="docutils literal notranslate"><span class="pre">tests/suites/src/sparsebase/preprocess/preprocess_tests.cc</span></code> will have the CTest test name:</p>
<div class="highlight-CMake notranslate"><div class="highlight"><pre><span></span>sparsebase_preprocess_preprocess_tests
</pre></div>
</div>
<p>And will have the executable name:</p>
<div class="highlight-CMake notranslate"><div class="highlight"><pre><span></span>sparsebase_preprocess_preprocess_tests
</pre></div>
</div>
<p>To add the executable and CTest test to the build system generation process, add the following lines to the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file in the test file’s directory:</p>
<div class="highlight-CMake notranslate"><div class="highlight"><pre><span></span><span class="c"># Add the executable target</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">&lt;test_executable_name&gt;</span> <span class="s">&lt;test_source_file&gt;</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">&lt;test_executable_name&gt;</span> <span class="s">sparsebase</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">&lt;test_executable_name&gt;</span> <span class="s">gtest</span> <span class="s">gtest_main</span><span class="p">)</span>

<span class="c"># Add the CTest test </span>
<span class="nb">add_test</span><span class="p">(</span><span class="s">NAME</span> <span class="s">&lt;CTest_test_name&gt;</span> <span class="s">COMMAND</span> <span class="s">&lt;test_executable_name&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, given that the test file we are adding is <code class="docutils literal notranslate"><span class="pre">tests/suites/src/sparsebase/preprocess/preprocess_tests.cc</span></code>, we would add the following lines to the file <code class="docutils literal notranslate"><span class="pre">tests/suites/src/sparsebase/preprocess/CMakeLists.txt</span></code>:</p>
<div class="highlight-CMake notranslate"><div class="highlight"><pre><span></span><span class="c"># Add the executable target</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">sparsebase_preprocess_preprocess_tests.test</span> <span class="s">preprocess_tests.cc</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">sparsebase_preprocess_preprocess_tests.test</span> <span class="s">sparsebase</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">sparsebase_preprocess_preprocess_tests.test</span> <span class="s">gtest</span> <span class="s">gtest_main</span><span class="p">)</span>

<span class="c"># Add the CTest test </span>
<span class="nb">add_test</span><span class="p">(</span><span class="s">NAME</span> <span class="s">sparsebase_preprocess_preprocess_tests</span> <span class="s">COMMAND</span> <span class="s">sparsebase_preprocess_preprocess_tests.test</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="what-about-cmake-options-and-flags">
<h3>What about CMake options and flags?<a class="headerlink" href="#what-about-cmake-options-and-flags" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">SparseBase</span></code> has many compilation options ranging from including different architectures (e.g. <code class="docutils literal notranslate"><span class="pre">CUDA</span></code>) to different I/O library support (e.g. <code class="docutils literal notranslate"><span class="pre">PIGO</span></code>). We incorporate these flags into testing in the same way we do in the compilation of the library:</p>
<ul class="simple">
<li><p>If the entirety of a test file is conditional on an option, we make its executable and test decleration conditional on that option at the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> level.</p></li>
<li><p>If some tests within a test file are conditional on an option, we use preprocessor directives inside the test source code to control these tests.</p></li>
</ul>
<p>The following subsections elaborate on these two approaches.</p>
<section id="conditional-compilation">
<h4>Conditional compilation<a class="headerlink" href="#conditional-compilation" title="Permalink to this headline"></a></h4>
<p>If there is a certain test file that is conditional on a CMake option, then you can simply surround the executable and test declerations of that test (shown in step 4 of “Adding a new test file”) with an <code class="docutils literal notranslate"><span class="pre">if()</span></code> call contingent on that option.</p>
<p>For example, the test file <code class="docutils literal notranslate"><span class="pre">tests/suites/sparsebase/preprocess/cuda/preprocess_tests.cu</span></code> should only be added when the library is compiled with the <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> option enabled. Here is how we define its executable and tests in the file <code class="docutils literal notranslate"><span class="pre">tests/suites/sparsebase/preprocess/cuda/CMakeLists.txt</span></code>:</p>
<div class="highlight-CMake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="o">${</span><span class="nv">CUDA</span><span class="o">}</span><span class="p">)</span>
    <span class="nb">add_executable</span><span class="p">(</span><span class="s">sparsebase__preprocess_cuda_preprocess_tests.test</span> <span class="s">preprocess_tests.cu</span><span class="p">)</span>
    <span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">sparsebase_preprocess_cuda_preprocess_tests.test</span> <span class="s">sparsebase</span><span class="p">)</span>
    <span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">sparsebase_preprocess_cuda_preprocess_tests.test</span> <span class="s">gtest</span> <span class="s">gtest_main</span><span class="p">)</span>

    <span class="nb">add_test</span><span class="p">(</span><span class="s">NAME</span> <span class="s">sparsebase_preprocess_preprocess_cuda_tests</span> <span class="s">COMMAND</span> <span class="s">sparsebase_preprocess_preprocess_cuda_tests.test</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="conditional-tests-within-a-test-file">
<h4>2. Conditional tests within a test file<a class="headerlink" href="#conditional-tests-within-a-test-file" title="Permalink to this headline"></a></h4>
<p>If a certain code (or test) within a test file is conditional on a CMake option, you can surround that code with a preprocessor if statement. Note: make sure that the test file includes the <code class="docutils literal notranslate"><span class="pre">sparsebase/config.h</span></code> file since that is where all the CMake flags are defined.</p>
<p>For example, if a certain test is only required when the library is compiled with <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> enabled, we can define that test in the code as follows:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;sparsebase/config.h&quot;</span><span class="cp"></span>

<span class="cp">#ifdef CUDA</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">CudaTestSuite</span><span class="p">,</span> <span class="n">CudaInitialization</span><span class="p">){</span>
  <span class="c1">// code</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="running-tests">
<h1>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline"></a></h1>
<p>Users can run unit tests easily after building the project. To do so, they must configure CMake to compile tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build 
<span class="nb">cd</span> build
cmake -DRUN_TESTS<span class="o">=</span>ON ..
make
</pre></div>
</div>
<p>Once its built, while in the build directory, do the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">V</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="github_guide.html" class="btn btn-neutral float-left" title="Making Contributions to the Repo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SparCity Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>